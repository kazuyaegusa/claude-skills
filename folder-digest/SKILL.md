---
name: folder-digest
description: カレントフォルダの全ファイルを読み込み、内容を的確かつ網羅的に把握して構造化レポートを出力するスキル。
user_invocable: true
---

# Folder Digest — フォルダ内容の自動把握スキル

カレントディレクトリ（およびサブディレクトリ）の全ファイルを調査し、内容を的確かつ網羅的に把握して構造化レポートを出力する。

## 実行手順

### Phase 1: ディレクトリ構造のスキャン

1. `Bash` で `ls -laR` を実行し、ディレクトリ全体のファイル一覧を取得する
2. `Glob` で `**/*` を実行し、全ファイルパスを取得する
3. ファイルを以下のカテゴリに分類する:
   - **テキスト系**（読み込み対象）: `.md`, `.txt`, `.json`, `.csv`, `.yaml`, `.yml`, `.toml`, `.xml`, `.html`, `.log`, `.env.example`
   - **コード系**（読み込み対象）: `.py`, `.js`, `.ts`, `.go`, `.rs`, `.sh`, `.sql`, `.rb`, `.java`, `.swift`, `.kt`, 等
   - **ドキュメント系**（読み込み対象）: `.pdf`（Readツールで読める）
   - **メディア系**（メタデータのみ）: `.mp4`, `.mp3`, `.wav`, `.m4a`, `.mov`, `.avi`, `.png`, `.jpg`, `.jpeg`, `.gif`, `.svg`, `.webp`
   - **データ系**（読み込み対象）: `.csv`, `.tsv`, `.jsonl`, `.ndjson`, `.parquet`（先頭数行）
   - **設定系**（読み込み対象）: `Dockerfile`, `docker-compose.yml`, `Makefile`, `package.json`, `pyproject.toml`, `.gitignore`, `CLAUDE.md`, 等
   - **バイナリ/大容量**（サイズのみ）: `.zip`, `.tar`, `.gz`, `.db`, `.sqlite`, その他バイナリ

### Phase 2: ファイル内容の読み込み

1. **テキスト・コード・設定ファイル**: `Read` ツールで全文読み込む（1ファイル2000行以上の場合は先頭500行 + 末尾100行）
2. **データファイル（CSV等）**: 先頭30行を `Read` で読み込み、構造を把握する
3. **PDFファイル**: `Read` ツールで読み込む（10ページ以上の場合は `pages: "1-10"` で先頭10ページ）
4. **画像ファイル**: `Read` ツールで視覚的に内容を確認する
5. **メディアファイル（動画/音声）**: `Bash` で `file` コマンドを実行しメタデータを取得する
6. **大容量ファイル（10MB超）**: 読み込まず、サイズとファイル形式のみ記録する

**並列化**: 独立した複数ファイルの読み込みは可能な限り並列で行い、速度を最大化する。

### Phase 3: 分析と構造化

読み込んだ内容を分析し、以下を推論する:

1. **フォルダの目的**: 何のためのフォルダか（プロジェクト、会議記録、データセット、設計資料等）
2. **ファイル間の関係**: ファイル同士の関連性（例: 動画 → 書き起こし → 要約）
3. **主要な情報**: 各ファイルのコア情報を抽出
4. **コンテキスト**: プロジェクト名、関係者、時期、ステータス等

### Phase 4: レポート出力

以下のフォーマットで出力する:

```markdown
## フォルダダイジェスト: {フォルダ名}

### 概要
{フォルダの目的・背景を2-3文で}

### ファイル構成
| ファイル | 種類 | サイズ | 概要 |
|---------|------|--------|------|
| ... | ... | ... | ... |

### 内容サマリー

#### {ファイル名1}
- **種類**: {ファイルタイプ}
- **内容**: {コア情容の要約。テキストファイルなら主要トピック、データファイルなら列構成とレコード数、コードなら主要機能}

#### {ファイル名2}
...

### キーファインディングス
- {フォルダ全体から読み取れる重要な情報・洞察}
- {ファイル間の関係性}
- {特記事項・注意点}

### 推奨アクション（該当する場合）
- {この情報に基づいて取れそうな次のアクション}
```

## 引数

スキル呼び出し時にパスを指定できる。省略時はカレントディレクトリ。

```
/folder-digest              → カレントディレクトリを分析
/folder-digest ./data       → ./data ディレクトリを分析
/folder-digest ~/Projects   → 指定パスを分析
```

## 注意事項

- `.env`, `credentials`, `secrets`, `*.key`, `*.pem` 等の機密ファイルは**内容を出力しない**。存在のみ報告する。
- `.git` ディレクトリは無視する（ただし `.gitignore` は読む）。
- `node_modules`, `__pycache__`, `.venv`, `venv`, `dist`, `build` 等の依存/ビルドディレクトリは無視する。
- ファイル数が100を超える場合は、主要ファイルに絞って分析し、残りはカテゴリ別の統計情報のみ出力する。
- バイナリファイルは読み込まない。

## Agent Team 自動編成

ファイル数が10以上、またはサブディレクトリが3つ以上ある場合は、自動でAgent Teamを編成して並列処理する:

- **scanner**: Explore型 — ディレクトリ構造のスキャンとファイル分類
- **reader-N**: Explore型 — ファイル内容の読み込み（ファイル群を分割して並列処理）
- **lead**: general-purpose型 — 全結果の統合とレポート生成
